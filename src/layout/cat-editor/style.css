/* ─── CAT Editor ───────────────────────────────────────────────────────────── */

.cat-editor-container {
  position: relative;
}

.cat-editor-inner {
  position: relative;
}

.cat-editor-root {
  outline: none;
}

.cat-editor-editable {
  min-height: 200px;
  padding: 1rem 1.25rem;
  font-size: 0.9375rem;
  line-height: 1.75;
  color: var(--foreground);
  outline: none;
  caret-color: var(--foreground);
}

.cat-editor-editable:focus {
  outline: none;
}

/* Read-only: fully non-interactive (no caret, no selection) */
.cat-editor-readonly {
  cursor: default;
  user-select: none;
  caret-color: transparent;
  opacity: 0.75;
}

/* Read-only but selectable: caret visible, text can be selected & copied */
.cat-editor-readonly-selectable {
  cursor: text;
}

/* ─── Japanese font stack ──────────────────────────────────────────────────── */

.cat-editor-jp-font .cat-editor-editable {
  font-family:
    'Noto Sans JP', 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', 'Yu Gothic',
    'Meiryo', sans-serif;
}

.cat-editor-paragraph {
  margin: 0;
}

.cat-editor-placeholder {
  position: absolute;
  top: 1rem;
  left: 1.25rem;
  color: var(--muted-foreground);
  pointer-events: none;
  user-select: none;
  font-size: 0.9375rem;
  opacity: 0.6;
}

/* ─── RTL support ──────────────────────────────────────────────────────────── */

.cat-editor-container[dir='rtl'] .cat-editor-placeholder {
  left: auto;
  right: 1.25rem;
  text-align: right;
}

.cat-editor-container[dir='rtl'] .cat-editor-editable {
  text-align: right;
}

/* ─── Highlight base ───────────────────────────────────────────────────────── */

.cat-highlight {
  cursor: pointer;
  border-radius: 2px;
  transition:
    background-color 0.15s ease,
    border-color 0.15s ease;
  position: relative;
}

/* ── Variant CSS custom properties (override from outside) ─────────────────
   Usage:
     .my-editor { --cat-spellcheck-bg: oklch(0.8 0.1 25 / 0.2); }
   or per-rule:
     .cat-highlight-spellcheck { --cat-spellcheck-underline: red; }
────────────────────────────────────────────────────────────────────────── */

/* ─── Spellcheck: red wavy underline + subtle red background ───────────── */

.cat-highlight-spellcheck {
  background-color: var(--cat-spellcheck-bg, oklch(0.7 0.2 25 / 0.12));
  border-bottom: 2px wavy var(--cat-spellcheck-underline, oklch(0.6 0.25 25));
}
.cat-highlight-spellcheck:hover {
  background-color: var(--cat-spellcheck-bg-hover, oklch(0.7 0.2 25 / 0.25));
}

/* ─── Keyword (generic term-match) ────────────────────────────────────── */

.cat-highlight-keyword {
  background-color: var(--cat-keyword-bg, oklch(0.7 0.15 280 / 0.12));
  border-bottom: 2px solid var(--cat-keyword-underline, oklch(0.6 0.2 280));
}
.cat-highlight-keyword:hover {
  background-color: var(--cat-keyword-bg-hover, oklch(0.7 0.15 280 / 0.25));
}

/* Keyword – tb-target: teal dashed underline */
.cat-highlight-keyword-tb-target {
  --cat-keyword-bg: oklch(0.7 0.12 175 / 0.12);
  --cat-keyword-underline: oklch(0.55 0.15 175);
  --cat-keyword-bg-hover: oklch(0.7 0.12 175 / 0.25);
  border-bottom-style: dashed;
}

/* Keyword – search: bold yellow highlight */
.cat-highlight-keyword-search {
  --cat-keyword-bg: oklch(0.9 0.16 95 / 0.45);
  --cat-keyword-underline: oklch(0.65 0.18 85);
  --cat-keyword-bg-hover: oklch(0.9 0.16 95 / 0.65);
}

/* ─── Special char (keyword-special-char): amber/orange dotted underline ─── */

.cat-highlight-keyword-special-char {
  background-color: var(--cat-special-char-bg, oklch(0.75 0.14 70 / 0.14));
  border-bottom: 2px dotted
    var(--cat-special-char-underline, oklch(0.6 0.18 70));
}
.cat-highlight-keyword-special-char:hover {
  background-color: var(
    --cat-special-char-bg-hover,
    oklch(0.75 0.14 70 / 0.28)
  );
}

/* ─── Tag: cyan/sky highlight ──────────────────────────────────────────── */

.cat-highlight-tag {
  background-color: var(--cat-tag-bg, oklch(0.78 0.1 210 / 0.12));
  border-bottom: 2px solid var(--cat-tag-underline, oklch(0.55 0.13 210));
  color: var(--cat-tag-text, inherit);
}
.cat-highlight-tag:hover {
  background-color: var(--cat-tag-bg-hover, oklch(0.78 0.1 210 / 0.25));
}

/* ─── Link: blue underline, clickable ──────────────────────────────────── */

.cat-highlight-link {
  background-color: var(--cat-link-bg, oklch(0.78 0.1 240 / 0.1));
  border-bottom: 1px solid var(--cat-link-underline, oklch(0.55 0.18 240));
  color: var(--cat-link-text, oklch(0.45 0.18 240));
  cursor: pointer;
  text-decoration: none;
}
.cat-highlight-link:hover {
  background-color: var(--cat-link-bg-hover, oklch(0.78 0.1 240 / 0.22));
  border-bottom-width: 2px;
}

/* ─── Mention: purple/violet highlight ─────────────────────────────────── */

.cat-highlight-mention {
  background-color: var(--cat-mention-bg, oklch(0.78 0.12 300 / 0.12));
  border-bottom: 2px solid var(--cat-mention-underline, oklch(0.55 0.18 300));
  color: var(--cat-mention-text, oklch(0.4 0.18 300));
  cursor: pointer;
}
.cat-highlight-mention:hover {
  background-color: var(--cat-mention-bg-hover, oklch(0.78 0.12 300 / 0.25));
}
/* ─── MentionNode (Lexical node, not highlight-based) ──────────────── */

.cat-mention-node {
  display: inline;
  padding: 0.0625rem 0.3rem;
  border-radius: 0.25rem;
  background-color: var(--cat-mention-bg, oklch(0.78 0.12 300 / 0.15));
  border-bottom: 2px solid var(--cat-mention-underline, oklch(0.55 0.18 300));
  color: var(--cat-mention-text, oklch(0.4 0.18 300));
  font-weight: 500;
  cursor: pointer;
  white-space: nowrap;
}
.cat-mention-node:hover {
  background-color: var(--cat-mention-bg-hover, oklch(0.78 0.12 300 / 0.3));
}

.cat-mention-label {
  /* inherits color from parent .cat-mention-node */
}

.cat-mention-avatar {
  display: inline-block;
  border-radius: 9999px;
  vertical-align: text-bottom;
  object-fit: cover;
  margin-right: 0.125rem;
}

.cat-mention-initials {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border-radius: 9999px;
  background: oklch(0.7 0.1 300 / 0.3);
  color: oklch(0.4 0.18 300);
  font-weight: 600;
  vertical-align: text-bottom;
  margin-right: 0.125rem;
}

/* ─── Mention typeahead popover ────────────────────────────────────── */

.cat-mention-popover {
  background: var(--popover);
  color: var(--popover-foreground);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow:
    0 4px 16px oklch(0 0 0 / 0.1),
    0 1px 4px oklch(0 0 0 / 0.06);
  min-width: 200px;
  max-width: 320px;
  padding: 0.25rem;
  animation: cat-popover-in 0.15s ease-out;
  z-index: 1000;
}
/* When search overlaps a tag, search bg takes priority */
.cat-highlight-tag.cat-highlight-keyword-search {
  background-color: var(--cat-keyword-bg, oklch(0.9 0.16 95 / 0.45));
  border-bottom-color: var(--cat-keyword-underline, oklch(0.65 0.18 85));
}
.cat-highlight-tag.cat-highlight-keyword-search:hover {
  background-color: var(--cat-keyword-bg-hover, oklch(0.9 0.16 95 / 0.65));
}

/* ─── Collapsed tag mode ───────────────────────────────────────────────── */

.cat-tags-collapsed .cat-highlight-tag.cat-highlight-tag-collapsed {
  border-bottom: none !important;
  background: none !important;
  background-image: none !important;
  vertical-align: baseline;
  padding: 0 !important;
}

/* Zero-width space in DOM; visual pill rendered by ::before. */
.cat-highlight-tag-collapsed {
  color: transparent !important;
  caret-color: var(--foreground, #000);
}
.cat-highlight-tag-collapsed::before {
  content: attr(data-display);
  color: var(--cat-tag-collapsed-text, oklch(0.4 0.15 210));
  background-color: var(--cat-tag-collapsed-bg, oklch(0.78 0.1 210 / 0.18));
  border-radius: 3px;
  padding: 0.0625rem 0.25rem;
  font-weight: 600;
  font-family: var(--font-mono, ui-monospace, monospace);
  font-size: 0.8125rem;
  line-height: 1.75;
  cursor: pointer;
  vertical-align: baseline;
  pointer-events: none;
  white-space: nowrap;
}
.cat-highlight-tag-collapsed:hover::before {
  background-color: var(
    --cat-tag-collapsed-bg-hover,
    oklch(0.78 0.1 210 / 0.35)
  );
}
.cat-tags-collapsed .cat-highlight-tag-collapsed:hover {
  background: none !important;
}

/* ─── Space char visual replacement ────────────────────────────────────── */

.cat-highlight-space-char {
  color: transparent !important;
  caret-color: var(--foreground, #000);
}
.cat-highlight-space-char::before {
  content: '·';
  color: oklch(0.55 0.1 70);
  position: absolute;
  width: 100%;
  text-align: center;
  pointer-events: none;
  left: 0;
}

/* ─── Quote-char nodes ─────────────────────────────────────────────────── */

.cat-highlight-quote-char {
  color: transparent !important;
  caret-color: var(--foreground, #000);
}
.cat-highlight-quote-char::before {
  content: attr(data-display);
  color: oklch(0.6 0.15 50);
  font-size: 0.9375rem;
  pointer-events: none;
  white-space: nowrap;
}

/* ─── NL-marker nodes (↩) ─────────────────────────────────────────────── */

.cat-highlight-nl-marker {
  cursor: default;
  background-color: transparent !important;
  border-bottom: none !important;
  background-image: none !important;
  color: oklch(0.55 0.1 70) !important;
  opacity: 0.7;
  font-size: 0.875rem !important;
  font-family:
    'Segoe UI Symbol', 'Apple Symbols', 'Noto Sans Symbols 2', system-ui,
    sans-serif !important;
  font-style: normal !important;
  font-weight: 400 !important;
  user-select: none;
}
.cat-highlight-nl-marker:hover {
  opacity: 1;
  background-color: oklch(0.75 0.14 70 / 0.14) !important;
}

/* ─── Nested highlights (overlapping rules) ────────────────────────────── */

.cat-highlight-nested {
  background-image: repeating-linear-gradient(
    -45deg,
    transparent,
    transparent 3px,
    oklch(0.5 0 0 / 0.06) 3px,
    oklch(0.5 0 0 / 0.06) 4px
  );
  border-bottom-style: double;
  border-bottom-width: 3px;
}

/* ─── Flash highlight (temporary pink overlay) ─────────────────────────── */

::highlight(cat-flash-range) {
  background-color: oklch(0.78 0.16 350 / 0.35);
}

.cat-highlight-flash {
  background-color: oklch(0.78 0.16 350 / 0.35) !important;
  border-bottom-color: oklch(0.6 0.22 350) !important;
  transition: background-color 0.2s ease;
}
.cat-highlight-flash.cat-highlight-tag-collapsed::before {
  background-color: oklch(0.78 0.16 350 / 0.35) !important;
}
.cat-highlight-flash.cat-highlight-quote-char::before {
  color: oklch(0.5 0.22 350) !important;
}

/* ═══════════════════════════════════════════════════════════════════════════
   Dark mode
   ═══════════════════════════════════════════════════════════════════════ */

.dark .cat-highlight-spellcheck {
  background-color: var(--cat-spellcheck-bg, oklch(0.5 0.2 25 / 0.25));
  border-bottom-color: var(--cat-spellcheck-underline, oklch(0.65 0.24 25));
}
.dark .cat-highlight-spellcheck:hover {
  background-color: var(--cat-spellcheck-bg-hover, oklch(0.5 0.2 25 / 0.4));
}

.dark .cat-highlight-keyword {
  background-color: var(--cat-keyword-bg, oklch(0.5 0.17 280 / 0.25));
  border-bottom-color: var(--cat-keyword-underline, oklch(0.65 0.2 280));
}
.dark .cat-highlight-keyword:hover {
  background-color: var(--cat-keyword-bg-hover, oklch(0.5 0.17 280 / 0.4));
}

.dark .cat-highlight-keyword-tb-target {
  --cat-keyword-bg: oklch(0.45 0.12 175 / 0.25);
  --cat-keyword-underline: oklch(0.6 0.14 175);
  --cat-keyword-bg-hover: oklch(0.45 0.12 175 / 0.4);
}

.dark .cat-highlight-keyword-search {
  --cat-keyword-bg: oklch(0.6 0.16 85 / 0.45);
  --cat-keyword-underline: oklch(0.75 0.18 85);
  --cat-keyword-bg-hover: oklch(0.6 0.16 85 / 0.65);
}

.dark .cat-highlight-keyword-special-char {
  background-color: var(--cat-special-char-bg, oklch(0.5 0.16 70 / 0.25));
  border-bottom-color: var(--cat-special-char-underline, oklch(0.65 0.18 70));
}
.dark .cat-highlight-keyword-special-char:hover {
  background-color: var(--cat-special-char-bg-hover, oklch(0.5 0.16 70 / 0.4));
}

.dark .cat-highlight-tag {
  background-color: var(--cat-tag-bg, oklch(0.45 0.12 210 / 0.25));
  border-bottom-color: var(--cat-tag-underline, oklch(0.6 0.14 210));
}
.dark .cat-highlight-tag:hover {
  background-color: var(--cat-tag-bg-hover, oklch(0.45 0.12 210 / 0.4));
}

.dark .cat-highlight-link {
  background-color: var(--cat-link-bg, oklch(0.45 0.12 240 / 0.25));
  border-bottom-color: var(--cat-link-underline, oklch(0.65 0.18 240));
  color: var(--cat-link-text, oklch(0.75 0.16 240));
}
.dark .cat-highlight-link:hover {
  background-color: var(--cat-link-bg-hover, oklch(0.45 0.12 240 / 0.4));
}

.dark .cat-highlight-mention {
  background-color: var(--cat-mention-bg, oklch(0.45 0.14 300 / 0.25));
  border-bottom-color: var(--cat-mention-underline, oklch(0.65 0.18 300));
  color: var(--cat-mention-text, oklch(0.8 0.16 300));
}
.dark .cat-highlight-mention:hover {
  background-color: var(--cat-mention-bg-hover, oklch(0.45 0.14 300 / 0.4));
}

.dark .cat-mention-node {
  background-color: var(--cat-mention-bg, oklch(0.45 0.14 300 / 0.3));
  border-bottom-color: var(--cat-mention-underline, oklch(0.65 0.18 300));
  color: var(--cat-mention-text, oklch(0.8 0.16 300));
}
.dark .cat-mention-node:hover {
  background-color: var(--cat-mention-bg-hover, oklch(0.45 0.14 300 / 0.45));
}

.dark .cat-mention-initials {
  background: oklch(0.5 0.12 300 / 0.4);
  color: oklch(0.8 0.16 300);
}

.dark .cat-mention-popover {
  box-shadow:
    0 4px 24px oklch(0 0 0 / 0.4),
    0 1px 4px oklch(0 0 0 / 0.2);
}

.dark .cat-highlight-tag.cat-highlight-keyword-search {
  background-color: var(--cat-keyword-bg, oklch(0.6 0.16 85 / 0.45));
  border-bottom-color: var(--cat-keyword-underline, oklch(0.75 0.18 85));
}
.dark .cat-highlight-tag.cat-highlight-keyword-search:hover {
  background-color: var(--cat-keyword-bg-hover, oklch(0.6 0.16 85 / 0.65));
}

.dark .cat-highlight-tag-collapsed::before {
  color: var(--cat-tag-collapsed-text, oklch(0.8 0.12 210));
  background-color: var(--cat-tag-collapsed-bg, oklch(0.4 0.1 210 / 0.4));
}
.dark .cat-highlight-tag-collapsed:hover::before {
  background-color: var(
    --cat-tag-collapsed-bg-hover,
    oklch(0.4 0.1 210 / 0.55)
  );
}

.dark .cat-highlight-space-char::before {
  color: oklch(0.65 0.14 70);
}

.dark .cat-highlight-quote-char::before {
  color: oklch(0.75 0.17 50);
}

.dark .cat-highlight-nested {
  background-image: repeating-linear-gradient(
    -45deg,
    transparent,
    transparent 3px,
    oklch(0.7 0 0 / 0.08) 3px,
    oklch(0.7 0 0 / 0.08) 4px
  );
}

/* ─── Popover ──────────────────────────────────────────────────────────── */

.cat-popover {
  background: var(--popover);
  color: var(--popover-foreground);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow:
    0 4px 16px oklch(0 0 0 / 0.1),
    0 1px 4px oklch(0 0 0 / 0.06);
  animation: cat-popover-in 0.15s ease-out;
  max-width: 380px;
}

.dark .cat-popover {
  box-shadow:
    0 4px 24px oklch(0 0 0 / 0.4),
    0 1px 4px oklch(0 0 0 / 0.2);
}

@keyframes cat-popover-in {
  from {
    opacity: 0;
    /* Use `translate` (independent CSS property) instead of `transform`
       so it does NOT override Popper.js's transform-based positioning. */
    translate: 0 -4px;
  }
  to {
    opacity: 1;
    translate: 0 0;
  }
}

/* ─── Badges ───────────────────────────────────────────────────────────── */

.cat-badge {
  display: inline-flex;
  align-items: center;
  padding: 0.125rem 0.5rem;
  border-radius: 9999px;
  font-size: 0.6875rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  line-height: 1.5;
}

.cat-badge-spell {
  background: oklch(0.7 0.2 25 / 0.15);
  color: oklch(0.5 0.2 25);
}
.dark .cat-badge-spell {
  background: oklch(0.5 0.2 25 / 0.3);
  color: oklch(0.75 0.2 25);
}

.cat-badge-keyword {
  background: oklch(0.7 0.15 280 / 0.15);
  color: oklch(0.5 0.2 280);
}
.dark .cat-badge-keyword {
  background: oklch(0.5 0.17 280 / 0.3);
  color: oklch(0.75 0.18 280);
}

.cat-badge-keyword-tb-target {
  background: oklch(0.7 0.12 175 / 0.15);
  color: oklch(0.45 0.15 175);
}
.dark .cat-badge-keyword-tb-target {
  background: oklch(0.45 0.12 175 / 0.3);
  color: oklch(0.7 0.14 175);
}

.cat-badge-keyword-search {
  background: oklch(0.9 0.16 95 / 0.35);
  color: oklch(0.4 0.15 85);
}
.dark .cat-badge-keyword-search {
  background: oklch(0.6 0.16 85 / 0.4);
  color: oklch(0.85 0.16 85);
}

.cat-badge-keyword-special-char {
  background: oklch(0.75 0.14 70 / 0.15);
  color: oklch(0.45 0.18 70);
}
.dark .cat-badge-keyword-special-char {
  background: oklch(0.45 0.14 70 / 0.3);
  color: oklch(0.75 0.16 70);
}

.cat-badge-tag {
  background: oklch(0.78 0.1 210 / 0.15);
  color: oklch(0.4 0.13 210);
}
.dark .cat-badge-tag {
  background: oklch(0.4 0.1 210 / 0.35);
  color: oklch(0.75 0.12 210);
}

.cat-badge-link {
  background: oklch(0.78 0.1 240 / 0.15);
  color: oklch(0.4 0.15 240);
}
.dark .cat-badge-link {
  background: oklch(0.4 0.1 240 / 0.35);
  color: oklch(0.75 0.14 240);
}

.cat-badge-mention {
  background: oklch(0.78 0.12 300 / 0.15);
  color: oklch(0.4 0.15 300);
}
.dark .cat-badge-mention {
  background: oklch(0.4 0.12 300 / 0.35);
  color: oklch(0.75 0.14 300);
}

/* Flash highlight dark mode */
.dark ::highlight(cat-flash-range) {
  background-color: oklch(0.45 0.18 350 / 0.4);
}

.dark .cat-highlight-flash {
  background-color: oklch(0.45 0.18 350 / 0.4) !important;
  border-bottom-color: oklch(0.65 0.22 350) !important;
}
.dark .cat-highlight-flash.cat-highlight-tag-collapsed::before {
  background-color: oklch(0.45 0.18 350 / 0.4) !important;
}
.dark .cat-highlight-flash.cat-highlight-quote-char::before {
  color: oklch(0.7 0.22 350) !important;
}

/* ─── Suggestion buttons ───────────────────────────────────────────────── */

.cat-suggestion-btn {
  display: inline-flex;
  align-items: center;
  padding: 0.25rem 0.625rem;
  font-size: 0.8125rem;
  border-radius: var(--radius);
  background: var(--secondary);
  color: var(--secondary-foreground);
  border: 1px solid var(--border);
  cursor: pointer;
  transition: all 0.15s ease;
  font-weight: 500;
}

.cat-suggestion-btn:hover {
  background: var(--primary);
  color: var(--primary-foreground);
  border-color: var(--primary);
}
